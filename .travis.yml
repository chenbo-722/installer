language: c
os:
  - linux
sudo: false
envs:
  global:
    - CONDA_DEPENDENCIES=constructor
    - PYTHON_VERSION=3.7
install:
  - git clone --depth 1 git://github.com/astropy/ci-helpers.git
  - source ci-helpers/travis/setup_conda.sh
script:
  - constrcutor constructor-cpu
  - constructor constructor-gpu
before_deploy:
  - git config --local user.name "njzjz"
  - git config --local user.email "jinzhe.zeng@rutgers.edu"
  - export TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)}
  - git tag $TRAVIS_TAG
deploy:
  provider: releases
  api_key: $GITHUB_TOKEN
  file: deepmd-kit-*pu-Linux-x86_64.sh
  skip_cleanup: true
  on:
    branch: master
